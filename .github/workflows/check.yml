---
name: Commitizen Check
on:
  workflow_call:
    inputs:
      runner:
        description: Which runner to run release workflow on.
        type: string
        default: ubuntu-latest

jobs:
  check:
    runs-on: ${{ startsWith(inputs.runner, '[') && fromJSON(inputs.runner) || inputs.runner }}
    steps:
      - name: Install Nix dependencies
        run: sudo apt-get update && sudo apt-get install -y curl xz-utils git

      - name: Install Nix
        uses: cachix/install-nix-action@v27
      - uses: DeterminateSystems/magic-nix-cache-action@main

      - name: Get workflow reference
        id: introspection
        uses: kobo-labs/introspect@v0.1.0
        with:
          github_token: ${{ github.token }}
          referenced_workflow: "kobo-labs/releaser/.github/workflows/check.yml"

      - uses: actions/checkout@v4
        with:
          token: ${{ github.token }}
          fetch-depth: 0

      - name: Check
        uses: jenseng/dynamic-uses@v1
        with:
          uses: kobo-labs/releaser@${{ steps.introspection.outputs.referenced_workflow_sha }}
          with: |
            {
              "cmd": "check ${{ github.workspace }}",
            }
